"use strict";(()=>{var e={};e.id=488,e.ids=[488],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},59398:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>A,patchFetch:()=>x,requestAsyncStorage:()=>f,routeModule:()=>w,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var n={};t.r(n),t.d(n,{GET:()=>m,runtime:()=>p});var a=t(49303),u=t(88716),s=t(60670),i=t(87070),o=t(90455),d=t(97220),l=t(53524);let p="nodejs",c=new l.PrismaClient;async function m(e){let r=(0,o.WX)(e.headers.get("authorization")||void 0);if(!r||!(0,o.Iq)([d.K.SISWA,d.K.ORANG_TUA],r.role))return i.NextResponse.json({message:"Unauthorized"},{status:401});let{searchParams:t}=new URL(e.url),n=Number(t.get("semester")||1),a=String(t.get("tahun")||"2024/2025"),u=null;if(r.role===d.K.SISWA){let e=await c.student.findUnique({where:{userId:r.userId}});u=e?.id||null}else{let e=await c.parent.findUnique({where:{userId:r.userId},include:{student:!0}});u=e?.student.id||null}if(!u)return i.NextResponse.json({message:"Siswa tidak ditemukan"},{status:404});let s=await c.grade.findMany({where:{studentId:u,semester:n,year:a},include:{subject:!0}}),l=await c.attendance.findUnique({where:{studentId_semester_year:{studentId:u,semester:n,year:a}}}),p=await c.eskulScore.findMany({where:{studentId:u,semester:n,year:a},include:{extracurricular:!0}}),m=await c.homeroomRemark.findUnique({where:{studentId_semester_year:{studentId:u,semester:n,year:a}}});return i.NextResponse.json({grades:s,attend:l,eskul:p,remark:m})}let w=new a.AppRouteRouteModule({definition:{kind:u.x.APP_ROUTE,page:"/api/student/grades/route",pathname:"/api/student/grades",filename:"route",bundlePath:"app/api/student/grades/route"},resolvedPagePath:"D:\\rapor-digital\\rapor-digital\\app\\api\\student\\grades\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:g}=w,A="/api/student/grades/route";function x(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},90455:(e,r,t)=>{t.d(r,{BN:()=>l,Iq:()=>m,VU:()=>d,WX:()=>c,cG:()=>p});var n=t(41482),a=t.n(n),u=t(42023),s=t.n(u);let i=new(t(53524)).PrismaClient,o=process.env.JWT_SECRET;async function d(e,r){let t=await i.user.findUnique({where:{email:e}});return t&&await s().compare(r,t.passwordHash)?t:null}async function l(e,r){let t=await i.student.findUnique({where:{nisn:e},include:{user:!0}});return t&&"SISWA"===t.user.role&&await s().compare(r,t.user.passwordHash)?t.user:null}function p(e){return a().sign({sub:e.id,role:e.role,name:e.name,email:e.email},o,{expiresIn:"8h"})}function c(e){if(!e)return null;let r=e.replace("Bearer ","");try{let e=a().verify(r,o);return{userId:Number(e.sub),role:e.role}}catch{return null}}function m(e,r){return r&&e.includes(r)}},97220:(e,r,t)=>{t.d(r,{K:()=>a});var n=t(53524);let a={ADMIN:n.Role.ADMIN,GURU:n.Role.GURU,WALI_KELAS:n.Role.WALI_KELAS,SISWA:n.Role.SISWA,ORANG_TUA:n.Role.ORANG_TUA}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[276,644],()=>t(59398));module.exports=n})();