"use strict";(()=>{var e={};e.id=518,e.ids=[518],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},72594:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>A,requestAsyncStorage:()=>S,routeModule:()=>_,serverHooks:()=>w,staticGenerationAsyncStorage:()=>x});var n={};r.r(n),r.d(n,{GET:()=>m,runtime:()=>c});var a=r(49303),i=r(88716),s=r(60670),o=r(87070),u=r(90455),d=r(97220),l=r(53524),p=r(17701);let c="nodejs",f=new l.PrismaClient;async function m(e,{params:t}){let r=(0,u.WX)(e.headers.get("authorization")||void 0);if(!r||!(0,u.Iq)([d.K.ADMIN,d.K.WALI_KELAS,d.K.SISWA,d.K.ORANG_TUA],r.role))return o.NextResponse.json({message:"Unauthorized"},{status:401});let{searchParams:n}=new URL(e.url),a=Number(n.get("semester")||1),i=String(n.get("tahun")||"2024/2025"),s=await f.student.findUnique({where:{id:Number(t.studentId)},include:{user:!0,class:!0}});if(!s)return o.NextResponse.json({message:"Siswa tidak ditemukan"},{status:404});let l=await f.grade.findMany({where:{studentId:s.id,semester:a,year:i},include:{subject:!0},orderBy:[{subject:{name:"asc"}}]}),c=await f.attendance.findUnique({where:{studentId_semester_year:{studentId:s.id,semester:a,year:i}}}),m=await f.eskulScore.findMany({where:{studentId:s.id,semester:a,year:i},include:{extracurricular:!0}}),_=await f.homeroomRemark.findUnique({where:{studentId_semester_year:{studentId:s.id,semester:a,year:i}}}),S=process.env.SCHOOL_NAME||"SMP Negeri 2 Ngunut",x=(0,p.y)(e=>{e.fontSize(14).text(S,{align:"center"}),e.fontSize(12).text("RAPOR SEMESTER",{align:"center"}),e.moveDown(),e.fontSize(10),e.text(`Nama   : ${s.user.name}`),e.text(`NISN   : ${s.nisn}`),e.text(`Kelas  : ${s.class?.name||"-"}`),e.text(`Tahun/Semester : ${i} / ${a}`),e.moveDown();let t=Array.from(new Set(l.map(e=>e.subject.name))),r=t.map(e=>{let t=t=>l.find(r=>r.subject.name===e&&r.type===t)?.value;return[e,String(t("HARIAN")??"-"),String(t("TUGAS")??"-"),String(t("PTS")??"-"),String(t("SAS")??"-"),String(t("RAPOR")??"-")]});(function(e,t,r,n,a,i){e.fontSize(9);let s=36,o=r;n.forEach((t,r)=>{e.rect(s,o,i[r],18).stroke(),e.text(t,s+4,o+4,{width:i[r]-8}),s+=i[r]}),o+=18,a.forEach(t=>{s=36,t.forEach((t,r)=>{e.rect(s,o,i[r],18).stroke(),e.text(t??"-",s+4,o+4,{width:i[r]-8}),s+=i[r]}),o+=18})})(e,0,e.y,["Mapel","Harian","Tugas","PTS","SAS","Rapor"],r,[140,60,60,60,60,60]),e.moveDown(),e.fontSize(11).text("Capaian Kompetensi:",{underline:!0}),t.forEach(t=>{let r=l.find(e=>e.subject.name===t&&"RAPOR"===e.type)?.desc;r&&e.fontSize(9).text(`â€¢ ${t}: ${r}`)}),e.moveDown(),e.fontSize(11).text("Absensi:",{underline:!0}),e.fontSize(10).text(`Sakit: ${c?.sakit??0}  |  Izin: ${c?.izin??0}  |  Alfa: ${c?.alfa??0}`),e.moveDown(),e.fontSize(11).text("Ekstrakurikuler:",{underline:!0}),m.forEach(t=>{e.fontSize(10).text(`${t.extracurricular.name}: ${t.nilai}${t.catatan?` (${t.catatan})`:""}`)}),e.moveDown(),e.fontSize(11).text("Catatan Wali Kelas:",{underline:!0}),e.fontSize(10).text(_?.note??"-"),e.moveDown(2);let n=e.y;e.fontSize(10).text("Orang Tua/Wali",36,n),e.fontSize(10).text("Wali Kelas",420,n),e.text("__________________",36,n+60),e.text("__________________",420,n+60)});return new o.NextResponse(x,{headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename="rapor_${s.nisn}_${a}.pdf"`}})}let _=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/report/[studentId]/pdf/route",pathname:"/api/report/[studentId]/pdf",filename:"route",bundlePath:"app/api/report/[studentId]/pdf/route"},resolvedPagePath:"D:\\rapor-digital\\rapor-digital\\app\\api\\report\\[studentId]\\pdf\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:S,staticGenerationAsyncStorage:x,serverHooks:w}=_,h="/api/report/[studentId]/pdf/route";function A(){return(0,s.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:x})}},90455:(e,t,r)=>{r.d(t,{BN:()=>l,Iq:()=>f,VU:()=>d,WX:()=>c,cG:()=>p});var n=r(41482),a=r.n(n),i=r(42023),s=r.n(i);let o=new(r(53524)).PrismaClient,u=process.env.JWT_SECRET;async function d(e,t){let r=await o.user.findUnique({where:{email:e}});return r&&await s().compare(t,r.passwordHash)?r:null}async function l(e,t){let r=await o.student.findUnique({where:{nisn:e},include:{user:!0}});return r&&"SISWA"===r.user.role&&await s().compare(t,r.user.passwordHash)?r.user:null}function p(e){return a().sign({sub:e.id,role:e.role,name:e.name,email:e.email},u,{expiresIn:"8h"})}function c(e){if(!e)return null;let t=e.replace("Bearer ","");try{let e=a().verify(t,u);return{userId:Number(e.sub),role:e.role}}catch{return null}}function f(e,t){return t&&e.includes(t)}},17701:(e,t,r)=>{r.d(t,{y:()=>i});var n=r(61245),a=r(76162);function i(e){let t=new a.PassThrough,r=new n.Z({size:"A4",margin:36});return r.pipe(t),e(r),r.end(),t}},97220:(e,t,r)=>{r.d(t,{K:()=>a});var n=r(53524);let a={ADMIN:n.Role.ADMIN,GURU:n.Role.GURU,WALI_KELAS:n.Role.WALI_KELAS,SISWA:n.Role.SISWA,ORANG_TUA:n.Role.ORANG_TUA}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,644,245],()=>r(72594));module.exports=n})();